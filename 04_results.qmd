# Results {#sec-results}

```{r setup, file = "R/chapter_start.R", include = FALSE}
# a number of commands need to run at the beginning of each chapter. This
# includes loading libraries that I always use, as well as options for 
# displaying numbers and text.
```

```{r setup2, include = FALSE}
# Other packages ------
# These are packages that get used in this chapter but aren't part of the default set.

library(ggplot2)
library(RColorBrewer)
library(kableExtra)
library(dplyr)
library(tidyr)
library(targets)
library(ggpattern)
library(extrafont)
library(scales)
```

This section details the outcomes of the Utah IMT Optimization project, employing the MATSim model to execute a series of simulations across a range of scenario groups. Specifically, the groups---Incidents, 20 IMT, and 30 IMT---were compared with a Baseline scenario, facilitating an evaluation of the repercussions of traffic incidents and the effectiveness of IMT in alleviating traffic disruptions.

The following sections analyze the results derived from the simulated scenarios. This analysis uses comparative metrics such as vehicle hours of delay (VHD), the consequences of traffic incidents, and the dynamics of the IMT responses in relation to the incidents they manage.

## Vehicle Hours of Delay

The studies referenced in the [IMT Optimization](#sec-lit_imt_opt) section of the [Literature Review](#sec-literature) demonstrate the efficacy of IMT in reducing RCT and ECU on roadway segments affected by incidents. Similarly, the results from this transportation model highlight the impact of IMT at reducing delay, particularly when focusing on the segments of roadways where incidents occurred; see [Impacted Links](#sec-impacted). In contrast to the cited studies, our model also explored the broader implications of incidents and their corresponding IMT responses on the simulated network. In a majority of scenarios, these results also indicated a positive correlation between IMT response and a decrease in VHD.

### Network Hours of Delay

In the comparison of network VHD across simulations, the scenarios were grouped by IMT response and incident frequency. Each group encompassed ten simulated scenarios, which involved different selections of incidents, with the exception of the Baseline scenario, which stands alone. @tbl-network_delays_table presents the average VHD for each group, based on the delays recorded in the final iteration of each simulation. These average VHD values are subsequently compared against the Baseline scenario to calculate the percentage change in VHD.

```{r delay_comparison}
#| label: tbl-network_delays_table
#| tbl-cap: Average Delay for Scenario Groups
tar_load(all_links_comparison_table)
all_links_comparison_table |> 
  kbl(booktabs = TRUE) |> 
  kable_styling(latex_options = "striped") %>%
  row_spec(0, bold = TRUE)

```

Upon comparing the results across different groups, it was observed that scenarios with 30 IMT experienced the lowest average VHD. They were closely followed by the 20 IMT scenarios, and, as expected, the scenarios that involved incidents only registered the highest average VHD values. It was also noted that introducing incidents to the baseline scenario resulted in an average VHD increase of 39%. However, this increase decreased to an average of 29% when 20 IMT were available, and further reduced to 25.6% with the availability of 30 IMT.

Further analysis of the data revealed that, compared to the Incidents group, the 20 IMT group decreased the average VHD by 7.2%, while the 30 IMT group reduced the average delay by 9.6%. Lastly, when the 30 IMT and 20 IMT groups were compared against each other, the former exhibited an average of 2.6% less VHD than the latter.

While the relationship between the IMT group and VHD appeared straightforward, the correlation between Incident Frequency and VHD was not as clear-cut. In the Incidents group, scenarios with increased incident frequency showed only a one percent increase in VHD compared to those with the current frequency. Intriguingly, for both the 20 IMT and 30 IMT groups, an increase in incident frequency actually led to slight decreases in average VHD.

Given that the table reveals average delay values aggregated across multiple scenarios within each group, a graphical representation can enhance clarity regarding the inherent variance within these data clusters. @fig-network_violin_plot illustrates this data through violin plots.

```{r all_links_plot}
#| label: fig-network_violin_plot
#| fig-cap: Average network delay violins.
tar_load(all_links_plot)
all_links_plot +
  # change the text style of the plot
  theme_minimal(base_family = "TeX Gyre Pagella", base_size = 12)
```

In @fig-network_violin_plot, each violin plot represents the density distribution of delay values, with wider sections indicating areas where numerous simulations converged around specific delay values. Conversely, narrower sections suggest fewer simulations clustering around those particular delay metrics. A dashed horizontal line is superimposed to facilitate comparison of each group with the results from the Baseline scenario. Additionally, diamond markers within each plot denote the mean delay across all simulations in the respective scenario group.

Upon examining these violin plots, several observations can be made. In the Incidents group, the distribution of delay values has a relatively narrow spread at the lower end, widening around the 100,000 mark, with the mean delay slightly skewed toward 104,000. This skewness is influenced by some values that approach 120,000 hours of delay. In contrast, the 20 IMT group exhibits significant variability, as reflected by its consistent width across the range of values. The scenarios within the 30 IMT group show marginally reduced variability compared to the 20 IMT group and feature distinct concentrations around 90,000 VHD and 100,000 VHD.

While the preceding section discussed delays across the entire network, it is important to note that all simulated incidents were located on motorway links, predominantly along the major interstates of Utah's Wasatch Front. This encompasses key routes such as I-15, I-80, and I-215, as well as other significant freeways and highways. The subsequent section will provide a detailed analysis of the simulation outcomes specifically related to these motorway links.

### Motorway Link Hours of Delay

The network used in our model is derived from an OpenStreetMap, which @lant2021 and @day2022 also utilized for their research projects. Within this network, the term 'motorway' denotes a specific type of link, also known as a freeway or expressway in different contexts. To ensure consistency throughout this document, we primarily refer to these road segments as 'motorway' or 'motorway links'. It is important to note, however, that in the simulation, incidents can occur on both interstates and major highways along the Wasatch Front.

To compare average simulation performances, the @tbl-motorway_delays_table table breaks down the average Motorway VHD for each group, categorized by IMT response and incident frequency.

```{r motorway_comparison}
#| label: tbl-motorway_delays_table
#| tbl-cap: Average VHD of Motorway Links
tar_load(motorway_summary_table)
motorway_summary_table |> 
  kbl(booktabs = TRUE) |> 
  kable_styling(latex_options = "striped") %>%
  row_spec(0, bold = TRUE)
```
@tbl-motorway_delays_table reveals that, in comparison to the Baseline scenario, the average VHD on motorway links increased by approximately 7,000-9,000 hours, or 45.6-58.1%, when incidents were introduced. The 20 IMT group, on average, exhibited a 24.2% increase in VHD from the Baseline, whereas the 30 IMT group experienced an average VHD increase of 17%.

At the motorway link level, the differences between the Incidents group and the IMT groups becomes more pronounced they were for delays across the entire network. Specifically, the 20 IMT group demonstrated an average 18.2% decrease in VHD compared to the Incidents group, while the 30 IMT group showed an average 22.9% decrease in VHD.

Interestingly, the difficulty in correlating VHD with incident frequency observed in @tbl-network_delays_table manifests differently in @tbl-motorway_delays_table. The latter table indicates that, within the IMT groups, an increase in incident frequency appears to correspond with an increase in VHD. Specifically, the 20 IMT group experiences an average VHD increase of 1.3% when transitioning from current to increased incident frequencies, while the 30 IMT group sees a 4.3% uptick under the same conditions. In contrast, and quite unexpectedly, the Incidents group shows a 7.9% reduction in VHD when comparing scenarios of current and increased incident frequencies. This finding is particularly perplexing given that @tbl-network_delays_table suggests an overall increase in VHD across the entire network for the Incidents group when incident frequency increases.

A potential explanation for these unexpected VHD outcomes on motorway links could be that, as part of their scoring and replanning process, some MATSim agents may have opted for non-motorway links to reach their destinations. This would essentially redistribute the delay from motorway links to other parts of the network.

For a better understanding of the variances within the scenario groups, @fig-motorway_violin_plot may provide additional insights.

```{r truck_data}
#| label: fig-motorway_violin_plot
#| fig-cap: Average motorway delay violins.
tar_load(motorway_links_plot)
motorway_links_plot +

  # change the text style of the plot
  theme_minimal(base_family = "TeX Gyre Pagella", base_size = 12) +

 # Change the x-axis text angle and horizontal justification
  theme(axis.text.x = element_text(angle = 30, hjust = 1))
```

As depicted in the fig-motorway_violin_plot, both the "incidents-only" scenario groupings exhibit wide spans throughout their plots, signifying a pronounced variance in delays across the simulations. Notably, the plots for both the *20-IMT* and *30-IMT* scenarios are wide near the baseline mean value, which hovers around 15,000 VHD. This expansion, however, diminishes as the scenarios transition to higher total delay hours. Particularly in outlier scenarios, the *30-IMT* fleet, equip with additional vehicles, seems to mitigate delay increases along the motorway links more effectively than is occasionally evident in the *20-IMT* vehicle scenarios.

Continuing the discussion, the final tier for comparing VHD is the *Impacted Links* on the network. These refer to the links where the simulated incidents take place, as well as the two links immediately preceding each incident link.

### Impacted Links {#sec-impacted}

Impacted links are described as the links where an incident occurs, along with its first two *Feeder* links. These are the two links through which traffic most commonly flows before reaching the incident motorway link. Given the variation in link lengths within the motorway, in certain instances, taking into account just two additional links may not adequately capture the delay prompted by a specific incident. Nevertheless, the @tbl-impacted_links offers significant insights about how delay on impacted links fluctuates based on the simulation scenario. For context regarding the table, Total VHD is computed by considering the duration of the incidents (from start to finish) and adding one hour post resolution of the incident. In the simulations conducted, IMT vehicles only enhance the capacity of the incident link, without shortening its duration. Therefore, for the 'Incident Impact Time', which encompasses the incident duration and an added hour, the delay values of the incident link and its two Feeder Links are aggregated to compute a 'Delay from Incident \[hours\]' variable, showcased in the subsequent scatter plot. To develop the summary_table, the values from all 'Delay from Incident \[hours\]' entries within a scenario and incident frequency group were summed. This sum equates to the Total VHD of delay value for each respective scenario. The results are presented below:

```{r impacted_summary_table}
#| label: tbl-impacted_links
#| tbl-cap: Impacted Links Table
tar_load(impacted_links_summary)
# Specify the note
note_a <- "Note: Current contains 90 incidents, Increased contains 193"

# Create the table with the note below it
impacted_links_summary %>% 
  kbl(booktabs = TRUE) %>%
  kable_styling(latex_options = "striped") %>%
  row_spec(0, bold = TRUE) %>%
  add_footnote(note_a)
```

The table presents a division of the Baseline scenario into two segments, for a more accurate comparison with the other three scenarios. Despite the absence of incidents in the Baseline scenario, its values are derived from the aggregate delay times of the same links included in the other scenarios.

From the cumulative delay data, it's clear that, in line with other VHD comparisons, the VHD in the *30-IMT* scenario most closely mirrors the baseline. This is followed by the *20-IMT* scenarios and then the *Incidents-only* groupings. As expected, a rise in incident frequency leads to an increase in Total VHD. However, the consideration of additional links makes a direct comparison of these values less straightforward.

For another perspective, the *Average Delay Per Incident \[hours\]* column divides the total VHD by the number of incidents within a given category (90 incidents in the current scenario and 193 in the increased frequency scenario). This calculation reveals something noteworthy: when comparing the average delay per incident between the current and increased incident frequencies under the incidents scenario, there's a significant 160% increase in the Average Delay Per Incident. This suggests that the incidents selected in the current scenario might have been, on average, more impactful than those in the increased scenario.

For a more detailed observation, the @fig-impacted_links_plot scatter plot below organizes data by seed type. Incident numbers and seed values serve as y-axis labels (e.g., "12_141" indicates a scenario with 12 incidents associated with the seed value 141). The scatter plot is presented as follows:

```{r impacted_links_plot}
#| label: fig-impacted_links_plot
#| fig-cap: Delay on impacted links sorted by seed. 
tar_load(impacted_links_plot)
impacted_links_plot +
  # change the text style of the plot
  theme_minimal(base_family = "TeX Gyre Pagella", base_size = 12) +
  theme(legend.position = c(0.95, 0.95),
        legend.justification = c("right", "top"),
        legend.background = element_rect(fill = "gray95", color = "gray50", linewidth = 0.5),
        legend.title.align = 0.5)

```

The scatter plot provides deeper insight into the nuances of the average incident impact calculations. In a manner similar to the @tbl-impacted_links, the scatter plot presents delay in terms of average delay per incident, which averages the delays from the incident links and their corresponding feeder links. At first glance, the data points representing the Baseline and Increased-IMT scenarios (in pink and green) seem to situate to the left of the blue dots depicting the Incidents-only scenarios. However, upon closer examination, one might discern that in certain scenarios, the Current-Fleet, Improved-Fleet, and occasionally both, perform sub-optimally compared to the Incidents-Only scenarios. This might initially appear counter intuitive, hinting at the possibility that factors beyond link capacity can influence delay. There exists an inherent randomness in MATSim's iterative process. The manner in which agents re-plan their journeys might, at times, influence delay as significantly, if not more, than variations in link capacity stemming from incidents and IMT arrivals. Notably, for the four Scenario IDs with the highest Average Incident Delays, the IMT units appear to substantially reduce the average delay on the affected links.

Moving ahead, another crucial variable emerges: the performance metrics associated with the IMT trucks. Such metrics encompass total travel time, the average distance traversed by each truck, and their average response time. Similar to VHD, these truck-related metrics might hold significance for UDOT and other transportation agencies. They will be elaborated upon in the subsequent section.

## IMT Vehicle Analysis

Equally critical to understanding how IMT implementation affects agent delay and travel time is assessing the efficiency of IMTs in reaching their intended destinations. This results segment delves into truck travel behavior, capturing metrics such as average travel times and distances, along with their typical incident response times. The analysis encompasses both *20-IMT* fleets scenarios and the *30-IMT* fleet scenarios.

### IMT Travel Time

Travel times for IMT trucks can be extracted from the event files, which are produced as a standard MATSim output. These files provide insights into the distance and time traveled by each IMT vehicle. Utilizing this truck travel data, plots were generated to illustrate the average travel times and distances for each dispatched truck within a given scenario. @fig-truck_time_plot illustrates the average travel time for each dispatched vehicle:

```{r truck_time_plot}
#| label: fig-truck_time_plot
#| fig-cap: Average truck travel time sorted by seed.
tar_load(truck_time_plot)
truck_time_plot +
    scale_fill_brewer(palette = "Set2") +
    scale_color_brewer(palette = "Set2", labels = c("20 IMT", "30 IMT")) +
    scale_size_continuous(breaks = c(5, 10, 15, 20), range = c(2, 8)) +  # Adjust range to make points smaller
    guides(fill = guide_legend(order = 1, override.aes = list(size = 6), 
                               title.position = "top", title.hjust = 0.5, ncol = 2, direction = "horizontal"),
           color = guide_legend(order = 1, override.aes = list(size = 6), 
                                title.position = "top", title.hjust = 0.5, ncol = 2, direction = "horizontal"),
          size = guide_legend(order = 2, title.position = "top", 
                               title.hjust = 0.5, ncol = 4, direction = "horizontal")) +
  
    theme_minimal(base_family = "TeX Gyre Pagella", base_size = 12) +
    theme(
      legend.position = "top",
      axis.text.x = element_text(angle = 45, hjust = 1),
    )

```

To computed the average travel time per truck we took the cumulative travel time for all dispatched vehicles in every scenario and then divided it by the number of trucks deployed. Furthermore, an analysis of the @truck_csv data reveals that scenarios with an "Increased" fleet of 30 vehicles generally dispatched more trucks than scenarios with a fleet of only 20 vehicles. A nearly analogous methodology was employed to generate the @fig-truck_distance_plot discussed in the subsequent section.

### IMT Travel Distance

As with the variation in truck_time across different scenario, there is a clear variance between *20-IMT* and *30-IMT* fleet scenarios in terms of the average distance traveled per dispatched vehicle. These results are visualized in the @fig-truck_distance_plot.

```{r truck_time_plot}
#| label: fig-truck_distance_plot
#| fig-cap: Average truck distance traveled sorted by seed.
tar_load(truck_distance_plot)
truck_distance_plot +
    scale_fill_manual(values = c(brewer.pal(8, "Set2")[3], brewer.pal(8, "Set2")[4])) +
    scale_color_manual(values = c(brewer.pal(8, "Set2")[3], brewer.pal(8, "Set2")[4]), labels = c("20 IMT", "30 IMT")) +
    scale_size_continuous(breaks = c(5, 10, 15, 20), range = c(2, 8)) +  # Adjust range to make points smaller
    guides(fill = guide_legend(order = 1, override.aes = list(size = 6), 
                               title.position = "top", title.hjust = 0.5, ncol = 2, direction = "horizontal"),
           color = guide_legend(order = 1, override.aes = list(size = 6), 
                                title.position = "top", title.hjust = 0.5, ncol = 2, direction = "horizontal"),
          size = guide_legend(order = 2, title.position = "top", 
                               title.hjust = 0.5, ncol = 4, direction = "horizontal")) +
  
    theme_minimal(base_family = "TeX Gyre Pagella", base_size = 12) +
    theme(
      legend.position = "top",
      axis.text.x = element_text(angle = 45, hjust = 1),
    )
```

The data presented in the above figure establishes a direct correlation between an increased number of vehicles and a decrease in average distance traveled per truck. Notably, the *30-IMT* fleet benefited in both time and distance scenarios by commencing from identical locations as the *20-IMT* fleet scenarios. This advantage was made more noticeable by the addition of vehicles to bridge the spatial intervals between the existing vehicles.

Altering the starting locations of the vehicles or having them circulate in a route, as opposed to commencing their activities from a stationary location, could potentially influence both the time and distance traveled in either a favorable or adverse manner. However, it's pertinent to note that the Utah Department of Transportation was not principally focused on determining the "optimal" starting location for IMT vehicles in this research. While this aspect was not explored in the present study, it presents an intriguing avenue for future investigations using the IMT deployment MATSim package associated with this report.

As highlighted by the work of @lou2011, in addition to fleet size, factors such as, vehicle starting locations, and whether IMTs operate as 'roaming entities' can all influence their response times. Altering the initial positions of the vehicles or directing them along specific routes, as opposed to a stationary start, can have substantial impacts on both the time and distance they cover, with potential advantages or drawbacks. However, it is important to note that determining the *optimal* starting points for IMT vehicles was not the primary focus of the Utah Department of Transportation in this research. While this particular dimension was not explored in our present study, it provides a compelling direction for future investigations using the IMT deployment MATSim package associated with this report.

### IMT Response Times

In the study conducted by @schultz2019, it is highlighted that, in Utah, a one-minute increase in IMT response time (RT) results in an approximate 0.8-minute increase in average roadway clearance time (RCT). This finding emphasizes the critical factor of IMT response times in reducing clearance times and subsequent delays. In the simulation conducted, incidents requested the support of one to four IMT units, with response times varying across different scenarios.

On average, across 280 simulated incidents, the arrival times in the *30-IMT* scenarios were 4 minutes faster than those in the *20-IMT* scenario, as detailed in @tbl-truck_arrival_table, which compares the average arrival times of the 1st, 2nd, 3rd, and 4th trucks.

```{r truck_arrival_table, results='asis'}
#| label: tbl-truck_arrival_table
#| tbl-cap: Average Truck Arrival Times
tar_load(truck_arrival_table)

# Update Scenario values
truck_arrival_table$Group <- recode(truck_arrival_table$Group, "2" = "20 IMTs", "3" = "30 IMTs")

truck_arrival_table |> 
  kbl(booktabs = TRUE) %>%
  kable_styling(latex_options = "striped") %>%
  row_spec(0, bold = TRUE) |> 
  row_spec(3, background = "gray65") # Light gray background for the last row


```

Examining @tbl-truck_arrival_table provides insight into the response patterns of IMT vehicles, highlighting their response to 280 out of 283 total incidents across both scenarios, with the remaining 3 incidents falling outside of the IMT operational hours. Within these responses, 116 incidents requested the assistance of a second IMT unit, 23 required a third, and 3 incidents called for a fourth truck. The scenarios including 30 IMT units consistently demonstrated faster average arrival times across nearly all categories, with the exception of the 4th truck arrival. This particular category, based on a limited sample of 3 incidents, showed mixed results; the 30-IMT fleet was faster in two instances but significantly slower in the third. Cumulatively, the *20-IMT* scenarios resulted in 105 hours of truck travel time, whereas the *30-IMT* scenarios reduced this total to 77 hours.

Further analysis of @truck_arrival_data indicates that the *20-IMT* fleet often dispatched the same truck to multiple incidents in quick succession, negatively impacting its arrival times. In contrast, the *30-IMT* scenarios, with more vehicles available, were less likely to engage in this practice.

\<\< To do: Consider exploring the dispatch patterns of the *NEW* trucks in the *30-IMT* scenarios, or alternatively, analyze the average number of trips per truck, drawing from the previous discussion. Determine which approach would yield more meaningful results. \>\>

@fig-truck_arrival_plot provides a detailed view of how arrival times varied across scenarios, with data points representing the difference in arrival times between the *20-IMT* and *30-IMT* scenarios. Positive values indicate quicker arrival times for the *30-IMT* fleet, while negative values indicate the opposite. The general trend suggests that the *30-IMT* fleet consistently achieved quicker arrival times, particularly in scenarios with a higher incident count.

```{r truck_arrival_plot}
#| label: fig-truck_arrival_plot
#| fig-cap: Difference in IMT Arrival Times, 20 IMTs minus 30 IMTs.
tar_load(truck_arrival_plot)
truck_arrival_plot +
  theme_minimal(base_family = "TeX Gyre Pagella", base_size = 12) +
  theme(legend.position = "top",
        legend.justification = c("center"),
        legend.background = element_rect(fill = "gray95", color = "gray50", linewidth = 0.5),
        legend.title.align = 0.5,
        legend.title = element_blank(),  # Add this line to remove the legend title
        axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))


```

From @fig-truck_arrival_plot, it becomes evident that the *30-IMT* vehicle fleet generally boasts shorter arrival times compared to the *20-IMT* fleet. While outliers exist within each truck's grouping, it is particularly noticeable that in scenarios with a higher incidence of incidents (18, 19, 20, and 21), the addition of 10 vehicles significantly enhances the overall arrival times of trucks, with the most pronounced improvements observed in the arrival times of the 2nd and 3rd trucks.

In summary, the combined results from the Vehicle Hours of Delay (VHD) and IMT Vehicle analysis demonstrate the efficacy of IMT vehicles in mitigating delays, particularly on the road segments directly impacted by incidents and their immediate surroundings. Additionally, an increase in the size of the vehicle fleet is directly associated with reductions in both the average travel time per truck and the response times per incident, underscoring the benefits of a larger IMT fleet in emergency response situations.