# Results {#sec-results}

```{r setup, file = "R/chapter_start.R", include = FALSE}
# a number of commands need to run at the beginning of each chapter. This
# includes loading libraries that I always use, as well as options for 
# displaying numbers and text.
```

```{r setup2, include = FALSE}
# Other packages ------
# These are packages that get used in this chapter but aren't part of the default set.

library(ggplot2)
library(RColorBrewer)
library(kableExtra)
library(dplyr)
library(tidyr)
library(targets)
library(ggpattern)
library(extrafont)
library(scales)
```

This section details the outcomes of the Utah IMT Optimization project, employing the MATSim model to execute a series of simulations across a range of scenario groups. Specifically, the groups---No IMT, 20 IMT, and 30 IMT---were compared with a Baseline scenario, facilitating an evaluation of the repercussions of traffic incidents and the effectiveness of IMT in alleviating traffic disruptions.

The following sections analyze the results derived from the simulated scenarios. This analysis uses comparative metrics such as vehicle hours of delay (VHD), the consequences of traffic incidents, and the dynamics of the IMT responses in relation to the incidents they manage.

## Vehicle Hours of Delay

The studies referenced in the [IMT Optimization](#sec-lit_imt_opt) section of the [Literature Review](#sec-literature) demonstrate the efficacy of IMT in reducing RCT and ECU on roadway segments affected by incidents. Similarly, the results from this transportation model highlight the impact of IMT at reducing delay, particularly when focusing on the segments of roadways where incidents occurred; see [Impacted Links](#sec-impacted). In contrast to the cited studies, our model also explored the broader implications of incidents and their corresponding IMT responses on the simulated network. In a majority of scenarios, these results also indicated a positive correlation between IMT response and a decrease in VHD.

### Network Hours of Delay

In the comparison of network VHD across simulations, the scenarios were grouped by IMT response and incident frequency. Each group encompassed ten simulated scenarios, which involved different selections of incidents, with the exception of the Baseline scenario, which stands alone. @tbl-network_delays_table presents the average VHD for each group, based on the delays recorded in the final iteration of each simulation. These average VHD values are subsequently compared against the Baseline scenario to calculate the percentage change in VHD.

```{r delay_comparison}
#| label: tbl-network_delays_table
#| tbl-cap: Average Delay on Network
tar_load(all_links_comparison_table)
all_links_comparison_table |> 
  kbl(booktabs = TRUE) |> 
  kable_styling(latex_options = "striped") %>%
  row_spec(0, bold = TRUE)

```

Upon comparing the results across different groups, it was observed that scenarios with 30 IMT experienced the lowest average VHD. They were closely followed by the 20 IMT group, and, as expected, the scenarios that involved incidents only registered the highest average VHD values. It is also noted that introducing incidents to the baseline scenario resulted in an average VHD increase of 39%. However, this increase dropped to an average of 29% when 20 IMT were available, and further reduced to 25.6% with the availability of 30 IMT.

Additional analysis of the data revealed that, compared to the No IMT group, the 20 IMT group decreased the average VHD by 7.2%, while the 30 IMT group reduced the average delay by 9.6%. Lastly, when the 30 IMT and 20 IMT groups were compared against each other, the former exhibited an average of 2.6% less VHD than the latter.

While the relationship between the IMT group and VHD appeared straightforward, the correlation between Incident Frequency and VHD was not as clear-cut. In the No IMT group, scenarios with increased incident frequency showed only a one percent increase in VHD compared to those with the current frequency. Intriguingly, for both the 20 IMT and 30 IMT groups, an increase in incident frequency actually led to slight decreases in average VHD. The cause of this decrease is unclear, but potential explanations will be discussed in [Limiations](#sec-limitations).

Given that @tbl-network_delays_table reveals average delay values aggregated across multiple scenarios within each group, a graphical representation can enhance clarity regarding the inherent variance within these data clusters. @fig-network_violin_plot illustrates this data through violin plots.

```{r all_links_plot}
#| label: fig-network_violin_plot
#| fig-cap: Average network delay violins.
tar_load(all_links_plot)
all_links_plot +
  # change the text style of the plot
  theme_minimal(base_family = "TeX Gyre Pagella", base_size = 12)
```

In @fig-network_violin_plot, each violin plot represents the density distribution of delay values, with wider sections indicating areas where numerous simulations converged around specific delay values. Conversely, narrower sections suggest fewer simulations clustering around those particular delay values. A dashed horizontal line is superimposed to facilitate comparison of each group with the results from the Baseline scenario. Additionally, diamond markers within each plot denote the mean delay across all simulations in the respective scenario group.

Upon examining these violin plots, several observations can be made. In the No IMT group, the distribution of delay values has a relatively narrow spread at the lower end, widening around the 100,000 mark, with the mean delay slightly skewed toward 104,000. This skew is influenced by some values that approach 120,000 hours of delay. In contrast, the 20 IMT group exhibits significant variability, as reflected by its consistent width across the range of values. The scenarios within the 30 IMT group show marginally reduced variability compared to the 20 IMT group and feature distinct concentrations around 90,000 VHD and 100,000 VHD.

While the preceding section discussed delays across the entire network, it is important to note that all simulated incidents were located on motorway links, predominantly along the major interstates of Utah's Wasatch Front. This encompasses key routes such as I-15, I-80, and I-215, as well as other significant freeways and highways. The subsequent section will provide a detailed analysis of the simulation outcomes specifically related to these motorway links.

### Motorway Link Hours of Delay

The network used in our model is derived from an OpenStreetMap, which @lant2021 and @day2022 also utilized for their research projects. Within this network, the term 'motorway' denotes a specific type of link, also known as a freeway or expressway in different contexts. To ensure consistency throughout this document, we primarily refer to these road segments as 'motorway' or 'motorway links'. It is important to note, however, that in the simulation, incidents can occur on both interstates and major highways along the Wasatch Front.

To compare average simulation performances, @tbl-motorway_delays_table breaks down the average Motorway VHD for each group, categorized by IMT response and incident frequency.

```{r motorway_comparison}
#| label: tbl-motorway_delays_table
#| tbl-cap: Average VHD of Motorway Links
tar_load(motorway_summary_table)
motorway_summary_table |> 
  kbl(booktabs = TRUE) |> 
  kable_styling(latex_options = "striped") %>%
  row_spec(0, bold = TRUE)
```
@tbl-motorway_delays_table reveals that, in comparison to the Baseline scenario, the average VHD on motorway links increased by approximately 7,000-9,000 hours, or 45.6-58.1%, when incidents were introduced. The 20 IMT group, on average, exhibited a 24.2% increase in VHD from the Baseline, whereas the 30 IMT group experienced an average VHD increase of 17%.

At the motorway link level, the differences between the No IMT group and the IMT groups becomes more pronounced they were for delays across the entire network. Specifically, the 20 IMT group demonstrated an average 18.2% decrease in VHD compared to the No IMT group, while the 30 IMT group showed an average 22.9% decrease in VHD.

Interestingly, the difficulty in correlating VHD with incident frequency observed in @tbl-network_delays_table manifests differently in @tbl-motorway_delays_table. The latter indicates that, within the IMT groups, an increase in incident frequency corresponds with an increase in VHD. Specifically, the 20 IMT group experiences an average VHD increase of 1.3% when transitioning from current to increased incident frequencies, while the 30 IMT group sees a 4.3% uptick under the same conditions. In contrast, and quite unexpectedly, the No IMT group shows a 7.9% reduction in VHD when comparing scenarios of current and increased incident frequencies. This finding is particularly perplexing given that @tbl-network_delays_table suggests an overall increase in VHD across the entire network for the No IMT group when incident frequency increases.

A potential explanation for these unexpected VHD outcomes on motorway links could be that, as part of their scoring and replanning process, some MATSim agents opted for travel on non-motorway links to reach their destinations. This would essentially redistribute the delay from motorway links to other parts of the network.

For a better understanding of the variances within the scenario groups, @fig-motorway_violin_plot may provide additional insights.

```{r truck_data}
#| label: fig-motorway_violin_plot
#| fig-cap: Average motorway delay violins.
tar_load(motorway_links_plot)
motorway_links_plot +

  # change the text style of the plot
  theme_minimal(base_family = "TeX Gyre Pagella", base_size = 12) +

 # Change the x-axis text angle and horizontal justification
  theme(axis.text.x = element_text(angle = 30, hjust = 1))
```

In @fig-motorway_violin_plot, we observe distinct patterns in the distribution of delays for different scenario groupings. Key observations include:

-   A wide span across the plots for both groupings of No IMT, indicating a significant variance in delays across those simulations.
-   A concentration of delays around the Baseline value of 15,000 VHD for both the 20 IMT and 30 IMT scenarios, as shown by the width of the plots at this point.
-   A narrowing of the IMT group plots as they transition to higher delay values, suggesting fewer instances of extreme delays.
-   The upper tails of the 20 IMT plots extend beyond those of the 30 IMT plots, suggesting that the 30 IMT fleet may be more effective at mitigating delays in outlier scenarios compared to the 20 IMT fleet.

The final section of our VHD analysis delves into the delays experienced on incident links and their immediate upstream counterparts. This level of analysis aligns with the methodologies employed in the studies by @schultz2019 and @skabardonis1998, as it focuses on the most direct repercussions of incidents and IMT. Unlike their focus on the impacts of IMT on RCT and ECU, our investigation centers on VHD. As detailed in [IMT Assignment and Response](#sec-imt_response), the IMT in our simulation did not curtail the duration of incidents (RCT); instead, they enhanced roadway capacity. Nonetheless, given that ECU is intrinsically related to delay, [Impacted Links](#sec-impacted) offers an evaluation of IMT performance similar to the analyses conducted by @schultz2019 and @skabardonis1998.

### Impacted Links {#sec-impacted}

Impacted Links examines VHD on incident links and their immediate upstream counterparts. Given the variation in link lengths across the motorway, in some cases, analyzing just two additional links may not fully capture the delays caused by a specific incident. Nevertheless, @tbl-impacted_links provides insights into how delays on impacted links vary based on incidents and IMT deployment. For additional context about the table: 'Total VHD' represents the delay on impacted links both during the incidents and for one hour after clearance, aiming to capture any residual delay shock waves that an incident might cause.

```{r impacted_summary_table}
#| label: tbl-impacted_links
#| tbl-cap: Impacted Links Delay
tar_load(impacted_links_summary)
# Specify the note
note_a <- "Note: Current contains 90 incidents, Increased contains 193"

# Create the table with the note below it
impacted_links_summary %>% 
  kbl(booktabs = TRUE) %>%
  kable_styling(latex_options = "striped") %>%
  row_spec(0, bold = TRUE) %>%
  add_footnote(note_a)
```

@tbl-impacted_links presents a division of the Baseline scenario into two segments, for a more accurate comparison with the other three scenarios. Despite the absence of incidents in the Baseline scenario, its delay values are derived from the same links included in the other scenarios.

The data in @tbl-impacted_links indicates that, within the 30 IMT group, delay patterns align most closely with the baseline. This is followed by the 20 IMT group, and subsequently, the No IMT group. It is important to note that directly comparing the Total VHD of the Current and Increased incident groups may not be appropriate due to variations in sample sizes, as underscored by @tbl-impacted_links. A more apt comparison might be to evaluate the average delay experienced per incident. Using this parameter, we observe an increase in the average VHD for both the 20 and 30 IMT groups, correlating with an uptick in the number of incidents. However, the scenarios involving No IMT yield a different outcome: both Total VHD and the average delay per incident exhibit a decrease when the incident frequency increased. A more close examination of the data draws attention to a particular scenario, Seed 141, which may have contributed an exceptionally large delay to the incident links in the Current Incident category. This anomaly could potentially explain the seemingly unexpected findings observed in the No IMT Current Incident frequency scenarios.

For a more detailed analysis, the scatter plot in @fig-impacted_links_plot categorizes the data based on seed type. On the y-axis, the labels represent a combination of incident numbers and seed values, with the format "number_seed" (e.g., "12_141" denotes a scenario involving 12 incidents associated with seed value 141).

```{r impacted_links_plot}
#| label: fig-impacted_links_plot
#| fig-cap: Delay on impacted links sorted by seed. 
tar_load(impacted_links_plot)
impacted_links_plot +
  # change the text style of the plot
  theme_minimal(base_family = "TeX Gyre Pagella", base_size = 12) +
  theme(legend.position = c(0.95, 0.95),
        legend.justification = c("right", "top"),
        legend.background = element_rect(fill = "gray95", color = "gray50", linewidth = 0.5),
        legend.title.align = 0.5)

```

@fig-impacted_links_plot offers a detailed view of the VHD on impacted links across the simulated scenarios. At a glance, the Baseline and 30 IMT scenarios, represented by blue and orange dots respectively, seem to predominantly cluster to the left of the pink dots, which depict the No IMT scenarios. However, a more thorough analysis reveals that in specific instances, the 20 IMT, 30 IMT, or even both scenarios may underperform compared to the No IMT scenarios. This seemingly unexpected observation suggests that there may be additional factors, aside from link capacity, affecting the delay.

It is important to acknowledge the inherent dynamic nature of the MATSim iterative process, where the ways in which agents re-plan their journeys can sometimes have as significant, or potentially even greater, impact on delays than changes in link capacity due to incidents or IMT. Importantly, in scenarios with the highest delays, the introduction of IMT seems to considerably reduce delay on the affected links.

Note that the x-axis has been limited to a maximum of 400+ VHD. This limit enhances the visibility of the majority of data points. Without this adjustment, the outlier point from the No IMT scenario with seed 141, which reported over 1,000 hours of delay, would have necessitated a much wider scale, potentially obscuring the trends and patterns in the rest of the data.

## IMT Vehicle Analysis

Equally critical to understanding how IMT performance is assessing the efficiency of each IMT in reaching their intended destinations. This results segment delves into truck travel behavior, capturing metrics such as average travel times and distances, along with their typical incident response times. The analysis encompasses both 20 IMT and 30 IMT scenarios.

### IMT Travel Time

Travel times for IMT can be extracted from the event files, which are produced as a standard MATSim output. These files provide insights into the distance and time traveled by each IMT. Utilizing this truck travel data, plots were generated to illustrate the average travel times and distances for each dispatched IMT within a given scenario. @fig-truck_time_plot illustrates the average travel time for each dispatched IMT:

```{r truck_time_plot}
#| label: fig-truck_time_plot
#| fig-cap: Average truck travel time sorted by seed.
tar_load(truck_time_plot)
truck_time_plot +
    scale_fill_brewer(palette = "Set2") +
    scale_color_brewer(palette = "Set2", labels = c("20 IMT", "30 IMT")) +
    scale_size_continuous(breaks = c(5, 10, 15, 20), range = c(2, 8)) +  # Adjust range to make points smaller
    guides(fill = guide_legend(order = 1, override.aes = list(size = 6), 
                               title.position = "top", title.hjust = 0.5, ncol = 2, direction = "horizontal"),
           color = guide_legend(order = 1, override.aes = list(size = 6), 
                                title.position = "top", title.hjust = 0.5, ncol = 2, direction = "horizontal"),
          size = guide_legend(order = 2, title.position = "top", 
                               title.hjust = 0.5, ncol = 4, direction = "horizontal")) +
  
    theme_minimal(base_family = "TeX Gyre Pagella", base_size = 12) +
    theme(
      legend.position = "top",
      axis.text.x = element_text(angle = 45, hjust = 1),
    )

```

To compute the average travel time per truck we took the cumulative travel time for all dispatched IMT in every scenario and then divided it by the number of trucks deployed. Furthermore, an analysis of the IMT travel data reveals that scenarios with 30 IMT generally dispatched more trucks than scenarios with a fleet of only 20 IMT. A nearly analogous methodology was employed to generate @fig-truck_distance_plot discussed in the subsequent section.

### IMT Travel Distance

As with the variation in IMT travel time across different scenario, there is a clear variance between 20 IMT and 30 IMT scenarios in terms of the average distance traveled per dispatched IMT. These results are visualized in @fig-truck_distance_plot.

```{r truck_time_plot}
#| label: fig-truck_distance_plot
#| fig-cap: Average truck distance traveled sorted by seed.
tar_load(truck_distance_plot)
truck_distance_plot +
    scale_fill_manual(values = c(brewer.pal(8, "Set2")[3], brewer.pal(8, "Set2")[4])) +
    scale_color_manual(values = c(brewer.pal(8, "Set2")[3], brewer.pal(8, "Set2")[4]), labels = c("20 IMT", "30 IMT")) +
    scale_size_continuous(breaks = c(5, 10, 15, 20), range = c(2, 8)) +  # Adjust range to make points smaller
    guides(fill = guide_legend(order = 1, override.aes = list(size = 6), 
                               title.position = "top", title.hjust = 0.5, ncol = 2, direction = "horizontal"),
           color = guide_legend(order = 1, override.aes = list(size = 6), 
                                title.position = "top", title.hjust = 0.5, ncol = 2, direction = "horizontal"),
          size = guide_legend(order = 2, title.position = "top", 
                               title.hjust = 0.5, ncol = 4, direction = "horizontal")) +
  
    theme_minimal(base_family = "TeX Gyre Pagella", base_size = 12) +
    theme(
      legend.position = "top",
      axis.text.x = element_text(angle = 45, hjust = 1),
    )
```

The data presented in @fig-truck_distance_plot establishes a direct correlation between an increased number of IMT and a decrease in average distance traveled per team. Notably, the 30 IMT fleet benefited in both time and distance scenarios by commencing from identical locations as the 20 IMT fleet scenarios. This advantage was made more noticeable by the addition of vehicles to bridge the spatial gaps between the existing vehicles.

Altering the starting locations of the IMT or having them operate in a roaming manner, as opposed to starting from a stationary location, can significantly influence the time and distance traveled, presenting both potential advantages and drawbacks. Although these factors, including fleet size and vehicle starting locations, were highlighted by @lou2011 as impactful in influencing IMT response times, it is important to clarify that determining the optimal starting points for IMT was not the primary focus of UDOT in this research. This aspect, while not explored in the current study, presents a valuable opportunity for future research, opening up an intriguing avenue for investigations using the ImtModule MATSim extension associated with this report.

### IMT Response Times

In the study conducted by @schultz2019, it is highlighted that, in Utah, a one-minute increase in IMT response time (RT) results in an approximate 0.8-minute increase in RCT. This finding emphasizes the critical factor of IMT response times in reducing clearance times and subsequent delays. In the simulation conducted, incidents requested the support of one to four IMT units, with response times varying across different scenarios. 

\<\< Dr. Macfarlane. You asked in your first edits if we can validate Dr. Schultz results. 
The answer is maybe. The issue is that IMT only change capacity, so we couldn't confirm correlation between RT and RCT. I could on the other hand, try and take the response time that I present here and see if I can connect it to our delay values. At present this data is just showing response time, and is not connected back to delay or other performance measures -D.J. \>\>

On average, across 280 simulated incidents, the arrival times in the 30 IMT scenarios were 4 minutes faster than those in the 20 IMT scenario, as detailed in @tbl-truck_arrival_table, which compares the average arrival times of the 1st, 2nd, 3rd IMT.

```{r truck_arrival_table, results='asis'}
#| label: tbl-truck_arrival_table
#| tbl-cap: Average Truck Arrival Times
tar_load(truck_arrival_table)

# Update Scenario values
truck_arrival_table$Group <- recode(truck_arrival_table$Group, "2" = "20 IMT", "3" = "30 IMT")

truck_arrival_table |> 
  kbl(booktabs = TRUE) %>%
  kable_styling(latex_options = "striped") %>%
  row_spec(0, bold = TRUE) |> 
  row_spec(3, background = "gray65") # Light gray background for the last row


```

@tbl-truck_arrival_table provides insights into the IMT response patterns, capturing their arrival at 280 out of 283 incidents across both scenarios. Note, the three unattended incidents fell outside the IMT operational hours. In the incidents that were attended, support from a second IMT was requested 116 times, a third IMT was requested 23 times, and a fourth IMT was called upon 3 times. However, due to the extremely small number of incidents requiring a fourth IMT, this category was considered too limited for significant analysis and was subsequently excluded from both the @tbl-truck_arrival_table and the @fig-truck_arrival_plot. In comparing arrival times, the scenarios with 30 IMT consistently outperformed those with 20 IMT, demonstrating quicker response times across all incident categories. On a cumulative level, the group with 20 IMT accrued a total of 105 hours of travel time, while the 30 IMT scenarios reduced the total travel time to 77 hours, marking a substantial decrease of nearly 27%.

An in-depth examination of the IMT travel data reveals that in the 20 IMT scenarios, IMT were frequently dispatched to attend to several incidents in quick succession, which adversely affected their arrival times. On the other hand, the scenarios with 30 IMT, benefiting from a larger fleet, were less prone to this pattern of deployment, ensuring more timely arrivals.

@fig-truck_arrival_plot offers a comprehensive visual representation, illustrating the variations in arrival times between the 20 and 30 IMT scenarios. Each data point on the plot signifies the discrepancy in arrival times, with positive values denoting faster responses by the 30 IMT fleet, and negative values indicating quicker arrivals by the 20 IMT fleet. The overarching trend observed in the plot underscores the improved performance of the 30 IMT fleet, especially noticeable in scenarios characterized by a larger number of incidents.

```{r truck_arrival_plot}
#| label: fig-truck_arrival_plot
#| fig-cap: Difference in IMT Arrival Times, 20 IMT minus 30 IMT.
tar_load(truck_arrival_plot)
truck_arrival_plot +
  theme_minimal(base_family = "TeX Gyre Pagella", base_size = 12) +
  theme(legend.position = "top",
        legend.justification = c("center"),
        legend.background = element_rect(fill = "gray95", color = "gray50", linewidth = 0.5),
        legend.title.align = 0.5,
        legend.title = element_blank(),  # Add this line to remove the legend title
        axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))


```

The data presented in @fig-truck_arrival_plot clearly demonstrates that the fleet of 30 IMT typically achieves faster arrival times than the 20 IMT fleet. Although there are outliers present in each group of trucks, it is especially apparent that in scenarios with an increased frequency of incidents (18, 19, 20, and 21), the inclusion of an additional 10 vehicles markedly optimizes the overall arrival times of the trucks. This improvement is most apparent in the arrival times of the 2nd and 3rd trucks.

In summary, the combined results from the VHD and IMT performance analysis demonstrate the deficiency of IMT in mitigating delays, particularly on the road segments directly impacted by incidents and their immediate surroundings. Additionally, an increase in the size of the vehicle fleet is directly associated with reductions in both the average travel time per truck and the response times per incident, underscoring the benefits of a larger IMT fleet in emergency response situations.